name: Test CD

on:
  push:
    branches:
      - master

jobs:
  run_pull:
    name: run pull
    runs-on: ubuntu-latest
    steps:
      - name: install liefer
        run: |
          go install github.com/lxgr-linux/liefer@latest
      - name: deploy
        env:
          LIEFER_PRIVKEY: ${{ secrets.LIEFER_PRIVKEY }}
          LXGR_HOST: ${{ secrets.LXGR_HOST }}
        run: |
          if [ -z "$LIEFER_PRIVKEY" ]; then
            echo "Error: LIEFER_PRIVKEY secret is missing. Deployment aborted."
            exit 1
          fi
          if [ -z "$LXGR_HOST" ]; then
            echo "Error: LXGR_HOST secret is missing. Deployment aborted."
            exit 1
          fi
          ~/go/bin/liefer deliver pokete_server ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}} "$LIEFER_PRIVKEY" --address "$LXGR_HOST":8080
