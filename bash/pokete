#!/usr/bin/env bash
# shellcheck disable=SC1091,2154
# this is bash, I won't develope this further

clear
# player
. ./player
poke1

# enemy
. ./enemys
enemylvl=$((RANDOM % 21 + 20))
enemylvl=$enemylvl$(python3 -c 'print('$((3 - ${#enemylvl}))'*" ")')
wpoke$((RANDOM % pokecount + 1))
enemyap=$enemyap$(python3 -c 'print('$((5 - ${#enemyap}))'*" ")')
enemyhp=$enemyhp$(python3 -c 'print('$((3 - ${#enemyhp}))'*" ")')

. ./attacks

$playeratc1
atcname1=$atcname
$playeratc2
atcname2=$atcname

end=0

while [ $end == 0 ]; do

    enemyap=$enemyap$(python3 -c 'print('$((5 - ${#enemyap}))'*" ")')
    enemyhp=$enemyhp$(python3 -c 'print('$((3 - ${#enemyhp}))'*" ")')
    playerhp=$playerhp$(python3 -c 'print('$((3 - ${#playerhp}))'*" ")')

    clear
    echo "_________________________________________________"
    echo "|$enemypoke|                              |"
    echo "|Lvl:$enemylvl         |                $epokeico1   |"
    echo "|AP:$enemyap HP:$enemyhp |                $epokeico2   |"
    echo "|----------------+                $epokeico3   |"
    echo "|                                 $epokeico4   |"
    echo "|                                               |"
    echo "|                                               |"
    echo "|                                               |"
    echo "|                                               |"
    echo "|   $pokeico1                +----------------|"
    echo "|   $pokeico2                |$playerpoke|"
    echo "|   $pokeico3                |Lvl:$playerlvl         |"
    echo "|   $pokeico4                |AP:$playerap HP:$playerhp |"
    echo "|______________________________|________________|"
    echo "+-----------------------------------------------+"
    echo "|                                               |"
    echo "|                                               |"
    echo "+-----------------------------------------------+"
    echo " 1 $atcname1"
    echo " 2 $atcname2"
    printf "Attack =>> "
    read -r inp

    if [ -z "$inp" ]; then
        continue
    elif [ "$inp" -eq 1 ]; then
        $playeratc1
        enemyhp=$((enemyhp - playeratk * atcfactor / enemydef))
        playerdef=$((playerdef + defbetter))
        playeratk=$((playeratk + atcbetter))
    elif [ "$inp" -eq 2 ]; then
        $playeratc2
        enemyhp=$((enemyhp - playeratk * atcfactor / enemydef))
        playerdef=$((playerdef + defbetter))
        playeratk=$((playeratk + atcbetter))
    fi

    $enemyatc1
    playerhp=$((playerhp - enemyatk * atcfactor / playerdef))

    if [ "$playerhp" -lt 0 ] || [ "$playerhp" -eq 0 ]; then
        echo "${enemypoke} (wild) won"
        end=1
    elif [ "$enemyhp" -lt 0 ] || [ "$enemyhp" -eq 0 ]; then
        echo "${playerpoke} (player) won!"
        end=1
    fi

done
